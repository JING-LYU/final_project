<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Insurance cost analysis</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="exploration.html">Data exploration</a>
</li>
<li>
  <a href="model-building.html">Model building</a>
</li>
<li>
  <a href="analysis.html">Analysis and discussion</a>
</li>
<li>
  <a href="mapping.html">Mapping</a>
</li>
<li>
  <a href="report.html">Report</a>
</li>
<li>
  <a href="mailto:&lt;yw3772@cumc.columbia.com&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/wyshanw/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Insurance cost analysis</h1>

</div>


<p><br></p>
<div id="model-building" class="section level2">
<h2>Model Building</h2>
<p><br></p>
<div id="model-selection" class="section level3">
<h3>Model selection</h3>
<p><strong>Correlation plot and information about each variable</strong></p>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<table>
<thead>
<tr class="header">
<th align="left">Variable name</th>
<th align="left">Variable information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">smoker</td>
<td align="left">0 = non-smoker, 1 = smoker</td>
</tr>
<tr class="even">
<td align="left">children_group</td>
<td align="left">0 = No children, 1 = Have at least 1 child</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="left">1 = male, 2 = female</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="left">Age range from 18 to 63</td>
</tr>
<tr class="odd">
<td align="left">bmi</td>
<td align="left">Body mass index range from 15.96 to 53.13</td>
</tr>
<tr class="even">
<td align="left">charges</td>
<td align="left">Cost of health insurance</td>
</tr>
</tbody>
</table>
<p>There is no collinearity between any of the variables. Therefore, no need to adjust variable for model building. In addition, smoking seems to be the highest correlated variable to charges among other variables.</p>
<p><br></p>
<p><strong>Fit regression using all predictors</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-12307.8163</td>
<td align="right">995.84054</td>
<td align="right">-12.3592240</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">smoker1</td>
<td align="right">23685.9237</td>
<td align="right">425.11537</td>
<td align="right">55.7164601</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">children_group1</td>
<td align="right">949.4232</td>
<td align="right">344.79196</td>
<td align="right">2.7536118</td>
<td align="right">0.0059792</td>
</tr>
<tr class="even">
<td align="left">sex2</td>
<td align="right">170.0998</td>
<td align="right">341.74401</td>
<td align="right">0.4977403</td>
<td align="right">0.6187543</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="right">260.0221</td>
<td align="right">12.32652</td>
<td align="right">21.0945321</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">bmi</td>
<td align="right">321.0280</td>
<td align="right">27.97673</td>
<td align="right">11.4748220</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<p>The model building result shows that sex is not a significant variable with p-valur &gt; 0.05. Therefore, when we do the stepwise regression, we would likely to remove the variable of sex.</p>
<p><br></p>
<p><strong>Stepwise regression</strong></p>
<pre><code>## Start:  AIC=21962.9
## charges ~ smoker + children_group + sex + age + bmi
## 
##                  Df  Sum of Sq        RSS   AIC
## - sex             1 9.0380e+06 4.5793e+10 21961
## &lt;none&gt;                         4.5784e+10 21963
## - children_group  1 2.7661e+08 4.6060e+10 21968
## - bmi             1 4.8035e+09 5.0587e+10 22087
## - age             1 1.6233e+10 6.2017e+10 22344
## - smoker          1 1.1325e+11 1.5903e+11 23531
## 
## Step:  AIC=21961.15
## charges ~ smoker + children_group + age + bmi
## 
##                  Df  Sum of Sq        RSS   AIC
## &lt;none&gt;                         4.5793e+10 21961
## + sex             1 9.0380e+06 4.5784e+10 21963
## - children_group  1 2.7576e+08 4.6068e+10 21967
## - bmi             1 4.7946e+09 5.0587e+10 22085
## - age             1 1.6261e+10 6.2054e+10 22342
## - smoker          1 1.1378e+11 1.5957e+11 23533</code></pre>
<pre><code>## 
## Call:
## lm(formula = charges ~ smoker + children_group + age + bmi, data = cost_df)
## 
## Coefficients:
##     (Intercept)          smoker1  children_group1              age  
##        -12204.7          23669.4            947.9            260.2  
##             bmi  
##           320.4</code></pre>
<p>The stepwise regression process confirm that sex is not significant variable.</p>
<p><br></p>
<p><strong>Here is the final model with significant variables:</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-12204.7408</td>
<td align="right">973.77880</td>
<td align="right">-12.533381</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">smoker1</td>
<td align="right">23669.4400</td>
<td align="right">423.69654</td>
<td align="right">55.864133</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">children_group1</td>
<td align="right">947.9286</td>
<td align="right">344.67562</td>
<td align="right">2.750205</td>
<td align="right">0.0060413</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">260.1708</td>
<td align="right">12.31921</td>
<td align="right">21.119120</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">bmi</td>
<td align="right">320.3547</td>
<td align="right">27.93564</td>
<td align="right">11.467599</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="model-diagnostic" class="section level3">
<h3>Model diagnostic</h3>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>The graph above did not show homoscedasticity of residual. Therefore, we need to transform the model.</p>
<p><br></p>
</div>
<div id="model-transformation" class="section level3">
<h3>Model transformation</h3>
<p><strong>Box-Cox Transformation</strong></p>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Since lamda = 0, try natural log transformation.</p>
<p><br></p>
<p><strong>Before transformation, remove outliers first</strong></p>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>The outliers are rows 544, 578, 1301. Following model building will use dataset without these outliers.</p>
<p><br> <strong>Transform charges to ln(charges)</strong></p>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p><br> <strong>Diagnostic for natural log transformed model</strong></p>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>Lamda is near 1 now, and the residual distribution improved from untransformed data. We conclude this model is suitable.</p>
<p><br></p>
<p>###The final model**</p>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">6.9338823</td>
<td align="right">0.0721953</td>
<td align="right">96.043415</td>
<td align="right">0e+00</td>
</tr>
<tr class="even">
<td align="left">smoker1</td>
<td align="right">1.5501799</td>
<td align="right">0.0313774</td>
<td align="right">49.404289</td>
<td align="right">0e+00</td>
</tr>
<tr class="odd">
<td align="left">children_group1</td>
<td align="right">0.2260899</td>
<td align="right">0.0255357</td>
<td align="right">8.853886</td>
<td align="right">0e+00</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.0355121</td>
<td align="right">0.0009124</td>
<td align="right">38.919881</td>
<td align="right">0e+00</td>
</tr>
<tr class="odd">
<td align="left">bmi</td>
<td align="right">0.0105884</td>
<td align="right">0.0020714</td>
<td align="right">5.111788</td>
<td align="right">4e-07</td>
</tr>
</tbody>
</table>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
