<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Insurance cost model building</title>

<script src="site_libs/header-attrs-2.10/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="exploration.html">Data exploration</a>
</li>
<li>
  <a href="medical_cost.html">Model building</a>
</li>
<li>
  <a href="discussion.html">Discussion</a>
</li>
<li>
  <a href="mapping.html">Mapping</a>
</li>
<li>
  <a href="report.html">Report</a>
</li>
<li>
  <a href="https://yiqunjin.shinyapps.io/shiny_dashboard/">Shiny Dashboard</a>
</li>
<li>
  <a href="mailto:&lt;yw3772@cumc.columbia.com&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="http://github.com/wyshanw/">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Insurance cost model building</h1>

</div>


<p><br></p>
<p><font size="3.5">In order to understand the amount of insurance price change due to smoking, along with other personal factors such age, sex, weight and whether or not having children, regression model need to be build and analysed. The model would also be useful to predict insurance price.</font></p>
<p><br></p>
<div id="a-snapshot-of-the-vairables" class="section level2">
<h2>A snapshot of the vairables</h2>
<div id="variable-meanings" class="section level3">
<h3>Variable meanings</h3>
<table>
<thead>
<tr class="header">
<th align="left">Variable name</th>
<th align="left">Variable information</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">smoker</td>
<td align="left">0 = non-smoker, 1 = smoker</td>
</tr>
<tr class="even">
<td align="left">children_group</td>
<td align="left">0 = No children, 1 = Have at least 1 child</td>
</tr>
<tr class="odd">
<td align="left">sex</td>
<td align="left">1 = male, 2 = female</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="left">Age range from 18 to 63</td>
</tr>
<tr class="odd">
<td align="left">bmi</td>
<td align="left">Body mass index range from 15.96 to 53.13</td>
</tr>
<tr class="even">
<td align="left">charges</td>
<td align="left">Cost of health insurance</td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
<div id="relationship-between-each-variables-and-charge-of-insurance" class="section level3">
<h3>Relationship between each variables and charge of insurance</h3>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-4-1.png" width="1152" /></p>
<p>At first glance, we can tell that smoking, age, and bmi significantly affect charge of insurance. The relationship between sex, having children and charge is unclear.</p>
<p><br></p>
</div>
</div>
<div id="model-selection" class="section level2">
<h2>Model selection</h2>
<div id="correlation-plot" class="section level3">
<h3>Correlation plot</h3>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>There is no collinearity between any of the variables. Therefore, no need to adjust variable for model building. In addition, smoking seems to be the highest correlated variable to charges among other variables.</p>
<p><br></p>
<p><strong>Fit regression using all predictors</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-6999.7519</td>
<td align="right">1768.35915</td>
<td align="right">-3.958332</td>
<td align="right">0.0000795</td>
</tr>
<tr class="even">
<td align="left">children_group</td>
<td align="right">1197.6286</td>
<td align="right">629.08881</td>
<td align="right">1.903751</td>
<td align="right">0.0571576</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="right">239.9951</td>
<td align="right">22.29965</td>
<td align="right">10.762281</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">bmi</td>
<td align="right">331.8887</td>
<td align="right">51.32710</td>
<td align="right">6.466149</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<p>The model building result shows that sex is not a significant variable with p-valur &gt; 0.05. Therefore, when we do the stepwise regression, we would likely to remove the variable of sex.</p>
<p><br></p>
</div>
<div id="stepwise-regression" class="section level3">
<h3>Stepwise regression</h3>
<pre><code>## Start:  AIC=24995.79
## charges ~ smoker + children_group + sex + age + bmi
## 
## 
## Step:  AIC=24995.79
## charges ~ smoker + children_group + age + bmi
## 
## 
## Step:  AIC=24995.79
## charges ~ children_group + age + bmi
## 
##                  Df  Sum of Sq        RSS   AIC
## &lt;none&gt;                         1.7263e+11 24996
## - children_group  1 4.6900e+08 1.7310e+11 24997
## - bmi             1 5.4106e+09 1.7804e+11 25035
## - age             1 1.4989e+10 1.8762e+11 25105</code></pre>
<pre><code>## 
## Call:
## lm(formula = charges ~ children_group + age + bmi, data = cost_df)
## 
## Coefficients:
##    (Intercept)  children_group             age             bmi  
##        -6999.8          1197.6           240.0           331.9</code></pre>
<p>The stepwise regression process confirm that sex is not significant variable.</p>
<p><br></p>
</div>
<div id="final-model-with-significant-variables" class="section level3">
<h3>Final model with significant variables</h3>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-6999.7519</td>
<td align="right">1768.35915</td>
<td align="right">-3.958332</td>
<td align="right">0.0000795</td>
</tr>
<tr class="even">
<td align="left">children_group</td>
<td align="right">1197.6286</td>
<td align="right">629.08881</td>
<td align="right">1.903751</td>
<td align="right">0.0571576</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="right">239.9951</td>
<td align="right">22.29965</td>
<td align="right">10.762281</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">bmi</td>
<td align="right">331.8887</td>
<td align="right">51.32710</td>
<td align="right">6.466149</td>
<td align="right">0.0000000</td>
</tr>
</tbody>
</table>
<p><br></p>
</div>
</div>
<div id="model-diagnostic" class="section level2">
<h2>Model diagnostic</h2>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>The graph above did not show homoscedasticity of residual. Therefore, we need to transform the model.</p>
<p><br></p>
</div>
<div id="model-transformation" class="section level2">
<h2>Model transformation</h2>
<div id="box-cox-transformation" class="section level3">
<h3>Box-Cox Transformation</h3>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>Since lamda = 0, try natural log transformation.</p>
<p><br></p>
<p><strong>Before transformation, remove outliers first</strong></p>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>The outliers are rows 544, 578, 1301. Following model building will use dataset without these outliers.</p>
<p><br></p>
<p><strong>Transform charges to ln(charges)</strong></p>
<pre><code>##       age            sex         bmi        children     smoker 
##  Min.   :18.0   Min.   :2   Min.   :15.96   0:572    Min.   :0  
##  1st Qu.:26.5   1st Qu.:2   1st Qu.:26.25   1:323    1st Qu.:0  
##  Median :39.0   Median :2   Median :30.40   2:240    Median :0  
##  Mean   :39.2   Mean   :2   Mean   :30.65   3:157    Mean   :0  
##  3rd Qu.:51.0   3rd Qu.:2   3rd Qu.:34.64   4: 25    3rd Qu.:0  
##  Max.   :64.0   Max.   :2   Max.   :53.13   5: 18    Max.   :0  
##     region             charges      children_group  
##  Length:1335        Min.   : 1122   Min.   :0.0000  
##  Class :character   1st Qu.: 4729   1st Qu.:0.0000  
##  Mode  :character   Median : 9361   Median :1.0000  
##                     Mean   :13162   Mean   :0.5715  
##                     3rd Qu.:16517   3rd Qu.:1.0000  
##                     Max.   :60021   Max.   :1.0000</code></pre>
<pre><code>## 
## Call:
## lm(formula = Lncharges ~ smoker + children_group + age + bmi, 
##     data = cost_df_log)
## 
## Coefficients:
##    (Intercept)          smoker  children_group             age             bmi  
##        7.31847              NA         0.24259         0.03359         0.01047</code></pre>
<p><br></p>
</div>
<div id="diagnostic-for-transformed-model" class="section level3">
<h3>Diagnostic for transformed model</h3>
<p><img src="medical_cost_files/figure-html/unnamed-chunk-13-1.png" width="672" /><img src="medical_cost_files/figure-html/unnamed-chunk-13-2.png" width="672" /></p>
<p>Lamda is near 1 now, and the residual distribution improved from un-transformed data. We conclude this model is acceptable.</p>
<p><br></p>
</div>
</div>
<div id="final-model" class="section level2">
<h2>Final model</h2>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="right">estimate</th>
<th align="right">std.error</th>
<th align="right">statistic</th>
<th align="right">p.value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">7.3184689</td>
<td align="right">0.1193421</td>
<td align="right">61.323446</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">children_group</td>
<td align="right">0.2425909</td>
<td align="right">0.0424161</td>
<td align="right">5.719318</td>
<td align="right">0.0000000</td>
</tr>
<tr class="odd">
<td align="left">age</td>
<td align="right">0.0335858</td>
<td align="right">0.0015023</td>
<td align="right">22.356253</td>
<td align="right">0.0000000</td>
</tr>
<tr class="even">
<td align="left">bmi</td>
<td align="right">0.0104654</td>
<td align="right">0.0034673</td>
<td align="right">3.018316</td>
<td align="right">0.0025902</td>
</tr>
</tbody>
</table>
<p><br></p>
<div id="decode-the-model-estimates" class="section level3">
<h3>Decode the model estimates</h3>
<p>Holding all other variable constant, smoking is associated with a 155% increase in insurance charges than non-smokers. Being older, higher body mass index, and having at least 1 children also increase insurance charges.</p>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
